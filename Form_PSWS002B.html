<script src="https://ipcenter-dev.pwcinternal.com/jquery/jquery.min.js"></script>

<script>

var token = 123;
var domain = "intusers";
var minLetters = "4";
var doneTypingInterval = 1500;  //time in ms, 1 second for example


var xhttp = new XMLHttpRequest();
var userL = [];
var typingTimer;
var prev = "###";


xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
       // Typical action to be performed when the document is ready:
	   var txt = xhttp.responseText.split("|");
	   var str = "";
	   var li = ""
	   var dl = $("#UserList");
	   dl.empty();
	   for (var i = 0; i < txt.length; i++) {
	     li = "<option value=" + '"' + txt[i].trim() + '">';
		 dl.append(li);
	   }
       $("#xx").html("&nbsp;");	
    }
};

function ADSearch(text) {
  var str = "http://10.240.248.242:8080/?token=" + token + "&action=search&domain=" + domain + "&search=" + text
  xhttp.open("GET", str, true);
  xhttp.send();
  console.log("Request Sent");
}

function doSearch(text) {
    console.log("doSearch " + text);
	if (text.length >= minLetters) {
	  var pos = text.search(prev)
	  if (pos < 0) {
	    console.log("search: " + text);
        $("#xx").html("searching...");
	    ADSearch(text);
	    prev = text;
	  } else {
	    console.log("new search is a substring of previous");
      }	  
	}
}

var i = 0;
$(document).ready(function(){
 $("#qq").keyup(function() {
  clearTimeout(typingTimer);
  var text = this.value;
  typingTimer = setTimeout(function() { doSearch(text) }, doneTypingInterval);
  });
});

$(document).ready(function(){
 $("#qq").keydown(function() {
  //on keydown, clear the countdown
  clearTimeout(typingTimer);
  });
});

function doAdd() {
	var xx = $("#qq");
	var u = xx.val();
	userL.push(u);
	var str = "";
	var arr = "";
	for(var i = 0; i < userL.length; i++) {
	  str += userL[i] + "<br>"
	  arr += userL[i] + "|"
	}
	$("#members").html(str);
	$("#UserList").empty();
	xx.val("");
	arr = arr.replace(/\|$/g,"");
	$("#input").val(arr)
}

</script>

<tr>
  <td class="list-padding radar_right radar_text">out:</td>
  <td class="list-padding radar_left radar_text">
    <span class="radar_error">$!{errors.out}</span>
   <input id="input" type="hidden"  name="variables['out']">
  </td>
</tr>
<tr>
  <td>

<div id="page-wrap">

<h3>Please Select User</h3>
Type minimum <script>document.write(minLetters)</script> letters to start searching
<br><br>
<div id="xx">&nbsp;</div>
<input id ="qq" size="30" list="UserList" name="UserList">
<datalist id="UserList">
</datalist>
</input>
<button type="button" id="add" onclick='doAdd()'>Add</button>
<br>
<span></span>
<br><br>
<span id="members">Hello</span>
<br>
</div>
